<% content_for :head do %>
<link rel="stylesheet" href="css/style.css">
<link rel="shortcut icon" href="/favicon.ico">
<% end %>

<% content_for :body do %>
<div class="menubar">
    <div class="loginname"><h2>ようこそ<%= User.find(session[:user]).name %>さん</h2></div>
    <div class="logout"><a href="/signout"><i class="fas fa-sign-out-alt"></i></a></div>
</div>

<div class="sdgs_img">
  <img src="img/goal1.png"  style="filter: saturate(<%= 100*@check/ 20 %>%)">
  <img src="img/goal2.png">
  <img src="img/goal3.png">
  <img src="img/goal4.png">
  <img src="img/goal5.png">
  <img src="img/goal6.png">
  <img src="img/goal7.png">
  <img src="img/goal8.png">
  <img src="img/goal9.png">
  <img src="img/goal10.png">
  <img src="img/goal11.png">
  <img src="img/goal12.png">
  <img src="img/goal13.png">
  <img src="img/goal14.png">
  <img src="img/goal15.png">
  <img src="img/goal16.png">
  <img src="img/goal17.png">
  <img src="img/goal18.png">
</div>

<h3 class="tassei"><p class="tasseiritu">達成率<%= @achievement %>%</p></h3>



<div class="body">
    <% @user_tasks.each do |user_task|%>
         <div class="card">
             <div class="title">
                 <%= Task.find(user_task.task_id).name %>
                 <% if user_task.check == true  %>
                      <label class="checkbox_hidden">
                          <input class="sdg<%= user_task.id %>" type ="checkbox" value="<%= user_task.id %>" id="check1" onChange="check(this.value, true, '.sdg<%= user_task.id %>' )" checked>
                      </label>
                 <% else %>
                     <label class="checkbox_hidden">
                        <input class="sdg<%= user_task.id %>" type ="checkbox" value="<%= user_task.id %>" id="check1" onChange="check(this.value, false, '.sdg<%= user_task.id %>')">
                    </label>
                 <% end %>
                 <br>
             </div>
             <img class="gohan_img" src="<%= Task.find(user_task.task_id).image %>" alt="食べ物を残さない写真">
        </div>
    <% end %>
 </div>
 
<div>
    <input id="checkbox1"/>
    <div class="title">
        <label class="checkbox_hidden">
            <input class="sdg" type ="checkbox" value="checkbox" onChange="check(this.value, true, '.sdg' )" checked>
        </label>
    </div>
</div>

<div class="content">
    <div class="modal js-modal">
        <div class="modal__bg js-modal-close"></div>
            <div class="modal__content">
                <p>すべての項目を達成しました。おめでとうございます！これからもSDGsを意識してより良い地球にしましょう。アプリをご利用いただきありがとうございました。</p>
                <a class="js-modal-close" href="">閉じる</a>
            </div><!--modal__inner-->
        </div><!--modal-->
    </div>
</div>

<div id="check_man">
    <% @tasks.each do |task|%>
        <h1>ここがカードになる</h1>
        <input type="checkbox" id="checkbox_test_<%= task.id %>" class="checkbox_hidden"/>
    <% end %>
</div>

<script>
    var current_check = <%= (100*@check/20) %>;
    function check(value, status, className){
        if (status  == true){
            current_check = current_check - 1 * 100 / 20;
            $('.sdgs_img').css('filter', 'saturate(' + current_check + '%)');
            $(className).attr('onChange', "check(this.value, false, '" + className + "')");
        } else {
             current_check = current_check + 1 * 100 / 20;
            $('.sdgs_img').css('filter', 'saturate(' + current_check + '%)');
            $(className).attr('onChange', "check(this.value, true, '" + className + "')");
        }
        $('.tasseiritu').html('達成率  ' + current_check + '%');
        $.post("/check/" + value);
        
        if (current_check == 100){
            $('.js-modal').fadeIn();
        }
    }
    
    window.onload = function(){
        var element = document.getElementById("check_man");
        element.onclick = switchCheck;
    }
    
    function switchCheck(){
        // console.log("hoge");
        var checkbox = document.getElementById("checkbox_test_1");
        checkbox.checked = !checkbox.checked;
        console.log(checkbox.checked);
    }
    
    $(function(){
    $('.js-modal-close').on('click',function(){
        $('.js-modal').fadeOut();
        return false;
    });
});
</script>
<% end %>